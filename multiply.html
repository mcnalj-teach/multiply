<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Multiplication Tables</title>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <div id="container">
      <svg id="multiply" width="700" height="700">
      </svg>
      <form id="ansForm" action=#>
        <select class="form-select" aria-label="Default select example" id="numSelect">
          <option selected>Number Selector</option>
          <option value="0">Full Table (Random)</option>
          <option value="1">Sixes through Nines (Random)</option>
          <option value="2">Twos</option>
          <option value="3">Threes</option>
          <option value="4">Fours</option>
          <option value="5">Fives</option>
          <option value="6">Sixes</option>
          <option value="7">Sevens</option>
          <option value="8">Eights</option>
          <option value="9">Nines</option>
        </select>
        <label id="questionLabel" for=answer>5 x 9 = </label><br>
        <input id="answer" type="text" name="answer" placeholder="your answer"></input><br><br>
        <input type="submit" class="btn btn-outline-primary btn-lg" value="Submit" id="submitBtn">
      </form>
    </div>
    <script>
  // Next Implement a sequential checkbox, and time, and reporting    
      // let colors = [(1, "black"), (2, "red"), (3, "white"), (4, "green"), (5, "brown"), (6, "blue" ), (7, "orange"), (8, "yellow"), (9, "purple")]
      // let fillColors = ['rgba(0,0,0,', 'rgba(255,0,0,', 'rgba(0,0,255,', 'rgba(0,128,0,', 'rgba(139,69,10,', 'rgba(0,0,128,', 'rgba(255,140,0,','rgba(255,215,0,','rgba(153,50,204,'];
      let fillColors = ['rgba(0,0,0,', 'rgba(255,0,0,', 'rgba(0,0,255,', 'rgba(0,255,0,', 'rgba(139,69,10,', 'rgba(0,0,128,', 'rgba(0,100,0,','rgba(220,20,0,','rgba(153,50,204,'];

      let sequential = false;
      let timesTable = 1;
      let sequentialMultiplier = 1
      var askedList = [];
      var missedList = [];
      const numSelect = document.getElementById("numSelect");
      numSelect.addEventListener('change', function() {
        timesTable = numSelect.value;
        sequentialMultiplier = 1;
        sequential = false;
        askedList = [];
        [multiplicand, multiplier, timesTable, askedList, missedList] = pickNumbersAndDrawCircles(timesTable);

      });
      [multiplicand, multiplier, timesTable, askedList, missedList] = pickNumbersAndDrawCircles(timesTable);
      document.getElementById("ansForm").onsubmit = function(event) {
        event.preventDefault();
        if (checkAnswer(multiplicand, multiplier)) {
          applyCorrectAnswerStyles();
          const myTimeout = setTimeout(function() {
            sequentialMultiplier++
            if (sequentialMultiplier > 10) {
              sequential = false;
              sequentialMultiplier = 1;
            }
            [multiplicand, multiplier, timesTable, askedList, missedList] = pickNumbersAndDrawCircles(timesTable);
            resetAnswerStyles();
          }, 1500);
        } else {
          applyIncorrectAnswerStyles();
          missedList.push(multiplier);
          const wrongTimeout = setTimeout(function(){
            resetAnswerStyles();
          }, 1600);
        }
      };

      function pickNumbersAndDrawCircles(timesTable) {
        document.getElementById("submitBtn").value = "Submit";
        const svgns = "http://www.w3.org/2000/svg"
        const svg = document.getElementById('multiply');
        while (svg.firstChild) {
          svg.removeChild(svg.firstChild);
        }
        [multiplicand, multiplier, timesTable, askedList, missedList] = pickNumbers(timesTable);
        let cx = 10;
        let cy = 60;
        const RADIUS = 25;
        const STROKE = "black";
        // let fill = "red";
        let opacity = 0.5;
        // let fillColor = 'rgba(255, 0, 0,' + opacity + ')';
        for (let j = 0; j < 10; j++) {
          for (let i = 0; i<10; i++) {
            let circ = document.createElementNS(svgns, "circle");
            cx = cx + 65;
            circ.setAttribute("cx", cx);
            circ.setAttribute("cy", cy);
            circ.setAttribute("r", RADIUS);
            circ.setAttribute("stroke", STROKE);
            if (j<multiplicand && i<multiplier) {
              // this makes horizontal opacity
              opacity = opacity + 0.05;
              fill = fillColors[multiplicand -1] + opacity + ')';
              // fill = fillColor;
            } else {
              fill = "LightGray"
            }
            circ.setAttribute("fill", fill);
            svg.appendChild(circ);
          }
          // this would make vertical opacity
          // opacity = opacity + 0.05;
          opacity = 0.5;
          fillColor = 'rgba(255, 0, 0,' + opacity + ')';
          cx = 10;
          cy = cy + 65;
        }
        setQuestion(multiplicand, multiplier);
        return [multiplicand, multiplier, timesTable, askedList, missedList];
      }

      function setQuestion(multiplicand, multiplier) {
        const questionLabel = document.getElementById("questionLabel");
        let question = multiplicand + " x " + multiplier + " =";
        questionLabel.innerHTML = question;
        document.getElementById("answer").focus();
      }

      function applyCorrectAnswerStyles(){
        document.getElementById("answer").style.backgroundColor = "green";
        document.getElementById("answer").style.color = "white";
      }

      function applyIncorrectAnswerStyles() {
        document.getElementById("answer").style.backgroundColor = "red";
        document.getElementById("answer").style.color = "white";
        document.getElementById("submitBtn").value = "Try Again";
      }

      function resetAnswerStyles() {
        document.getElementById("answer").style.backgroundColor = "white";
        document.getElementById("answer").style.color = "black";
        document.getElementById("answer").value = " ";
        document.getElementById("answer").focus();
      }
      function checkAnswer(multiplicand, multiplier) {
        let isCorrect = false;
        let userAnswer = document.getElementById("answer").value;
        let questionAnswer = multiplicand * multiplier;
        if (questionAnswer == userAnswer) {
          isCorrect = true;
        }
        return isCorrect;
      }

      function pickNumbers(timesTable) {
        let multiplicand = Math.floor(Math.random() * 9) + 1;
        let multiplier = Math.floor(Math.random() * 9) + 1;
        if ( timesTable == 0) {
          multiplicand = Math.floor(Math.random() * 9) + 1;
          multiplier = Math.floor(Math.random() * 9) + 1;
        } else if (timesTable == 1) {
          multiplicand = Math.floor(Math.random() * 5) + 5;
          multiplier = Math.floor(Math.random() * 5) + 5;
        } else if (timesTable > 1) {
          [timesTable, askedList, missedList] = moveToMissedQuestionsOrNextTable(timesTable, askedList, missedList);
          multiplicand = timesTable;
          if (sequential) {
            multiplier = sequentialMultiplier;
          } else {
            [askedList, multiplier] = setMultiplierNotInAskedList(askedList);
          }
        }
        return [multiplicand, multiplier, timesTable, askedList, missedList];
      }

      function resetMissedList(askedList, missedList) {
        for (var i = 0; i<missedList.length; i++) {
          for (var j = 0; j <askedList.length; j++) {
            if (askedList[j] == missedList[i]) {
              askedList.splice(j, 1);
            }
          }
        }
        missedList = [];
        return [askedList, missedList];
      }

      function moveToMissedQuestionsOrNextTable(timesTable, askedList, missedList) {
        if (askedList.length > 8) {
          if (missedList.length > 0) {
            [askedList, missedList] = resetMissedList(askedList, missedList);
          } else {
            timesTable++
            askedList = [];
          }
        }
        return [timesTable, askedList, missedList];
      }

      function setMultiplierNotInAskedList(askedList) {
        multiplier = Math.floor(Math.random() * 9) + 1;
        while (askedList.includes(multiplier)){
          multiplier = Math.floor(Math.random() * 9) + 1;
        }
        askedList = updateAskedList(askedList, multiplier);
        return [askedList, multiplier];
      }

      function updateAskedList(askedList, multiplier) {
        askedList.push(multiplier);
        return askedList;
      }
    </script>
  </body>
</html>
